<?php

namespace Tests\Unit\Controller;

use Joselfonseca\LaravelTactician\Bus;
use Persium\Station\Domain\Entities\Station\Station;
use Persium\Station\Domain\Entities\Station\StationRepositoryInterface;
use Persium\Station\Domain\Services\Cache\StationDataCacheInterface;
use Persium\Station\Domain\ValueObjects\StationAQIDataVO;
use Persium\Station\Http\Controllers\StationController;
use Persium\Station\Http\Controllers\WindMapController;
use Psr\Http\Message\ServerRequestInterface;
use Tests\TestCase;

class WindMapControllerUnitTest extends TestCase
{
    public function testIndexSuccess()
    {
        //mock bus
        $bus = $this->getMockBuilder(Bus::class)
            ->disableOriginalConstructor()
            ->getMock();
        $bus->method('addHandler')->willReturn(true);

        $expected_result = json_decode('[{"header":{"parameterUnit":"m.s-1","parameterNumber":2,"parameterNumberName":"eastward_wind","parameterCategory":2,"refTime":"2023-04-26 11:36:02","dx":0.77,"dy":0.5,"nx":17,"ny":17,"la1":58.08,"la2":-180,"lo1":-180,"lo2":2.16},"data":[-6.096280185026727,-6.096280185026727,-6.096280185026727,-6.096280185026727,-6.096280185026727,-6.096280185026727,-6.096280185026727,-6.096280185026727,-6.096280185026727,-6.096280185026727,-6.096280185026727,-6.096280185026727,-6.096280185026727,-6.096280185026727,-6.096280185026727,-6.096280185026727,-4.922996233839639,-6.096280185026727,-6.096280185026727,-6.096280185026727,-6.096280185026727,-6.096280185026727,-6.096280185026727,-6.096280185026727,-6.096280185026727,-6.096280185026727,-6.096280185026727,-6.096280185026727,-6.915503537188005,-1.961916975475677,-4.503067150119958,-4.503067150119958,-4.503067150119958,-5.250764603892439,0,0,-6.096280185026727,-6.096280185026727,-6.096280185026727,-6.096280185026727,-6.096280185026727,-6.096280185026727,-6.096280185026727,-6.096280185026727,-4.503067150119958,-4.503067150119958,-4.503067150119958,-4.503067150119958,-4.503067150119958,-4.503067150119958,-5.250764603892439,0,0,0,0,0,-6.096280185026727,-6.096280185026727,-6.096280185026727,-6.096280185026727,-4.503067150119958,-4.503067150119958,-4.503067150119958,-4.503067150119958,-4.503067150119958,-4.503067150119958,-4.503067150119958,-5.250764603892439,0,0,0,0,0,0,0,0,-4.503067150119958,-4.503067150119958,-4.503067150119958,-4.503067150119958,-4.503067150119958,-4.503067150119958,-4.503067150119958,-4.503067150119958,-5.250764603892439,0,0,0,0,0,0,0,0,0,-4.503067150119958,-4.503067150119958,-4.503067150119958,-4.503067150119958,-4.503067150119958,-4.503067150119958,-4.503067150119958,-5.250764603892439,0,0,0,0,0,0,0,0,0,0,0,-4.503067150119958,-4.503067150119958,-4.503067150119958,-4.503067150119958,-4.503067150119958,-5.250764603892439,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-1.1486041829408307,-1.1486041829408307,-2.260326303877385,-2.260326303877385,-2.260326303877385,0,0,0,0,0,0,0,0,0,0,0,0,-1.1486041829408307,-2.260326303877385,-2.260326303877385,-2.260326303877385,-2.260326303877385,-2.260326303877385,-2.260326303877385,0,0,0,0,0,0,0,0,0,0]},{"header":{"parameterUnit":"m.s-1","parameterNumber":3,"parameterNumberName":"northward_wind","parameterCategory":2,"refTime":"2023-04-26 11:36:02","dx":0.77,"dy":0.5,"nx":17,"ny":17,"la1":58.08,"la2":-180,"lo1":-180,"lo2":2.16},"data":[-2.3401427105308117,-2.3401427105308117,-2.3401427105308117,-2.3401427105308117,-2.3401427105308117,-2.3401427105308117,-2.3401427105308117,-2.3401427105308117,-2.3401427105308117,-2.3401427105308117,-2.3401427105308117,-2.3401427105308117,-2.3401427105308117,-2.3401427105308117,-2.3401427105308117,-2.3401427105308117,-3.1970311355382095,-2.3401427105308117,-2.3401427105308117,-2.3401427105308117,-2.3401427105308117,-2.3401427105308117,-2.3401427105308117,-2.3401427105308117,-2.3401427105308117,-2.3401427105308117,-2.3401427105308117,-2.3401427105308117,-1.4699356540815594,2.603551762754175,4.348561399073321,4.348561399073321,4.348561399073321,3.676624957010204,0,0,-2.3401427105308117,-2.3401427105308117,-2.3401427105308117,-2.3401427105308117,-2.3401427105308117,-2.3401427105308117,-2.3401427105308117,-2.3401427105308117,4.348561399073321,4.348561399073321,4.348561399073321,4.348561399073321,4.348561399073321,4.348561399073321,3.676624957010204,0,0,0,0,0,-2.3401427105308117,-2.3401427105308117,-2.3401427105308117,-2.3401427105308117,4.348561399073321,4.348561399073321,4.348561399073321,4.348561399073321,4.348561399073321,4.348561399073321,4.348561399073321,3.676624957010204,0,0,0,0,0,0,0,0,4.348561399073321,4.348561399073321,4.348561399073321,4.348561399073321,4.348561399073321,4.348561399073321,4.348561399073321,4.348561399073321,3.676624957010204,0,0,0,0,0,0,0,0,0,4.348561399073321,4.348561399073321,4.348561399073321,4.348561399073321,4.348561399073321,4.348561399073321,4.348561399073321,3.676624957010204,0,0,0,0,0,0,0,0,0,0,0,4.348561399073321,4.348561399073321,4.348561399073321,4.348561399073321,4.348561399073321,3.676624957010204,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.6901510203794727,0.6901510203794727,1.3049999999999993,1.3049999999999993,1.3049999999999993,0,0,0,0,0,0,0,0,0,0,0,0,0.6901510203794727,1.3049999999999993,1.3049999999999993,1.3049999999999993,1.3049999999999993,1.3049999999999993,1.3049999999999993,0,0,0,0,0,0,0,0,0,0]}]');
        $bus->method('dispatch')->willReturn($expected_result);

        $response = (new WindMapController($bus))
            ->index();
        $this->assertEquals(200, $response->getStatusCode());

        $this->assertEquals( json_encode(['data' => $expected_result]), $response->getContent());
    }
}
